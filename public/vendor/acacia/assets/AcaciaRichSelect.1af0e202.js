var v=Object.defineProperty;var f=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var m=(e,t,a)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,i=(e,t)=>{for(var a in t||(t={}))y.call(t,a)&&m(e,a,t[a]);if(f)for(var a of f(t))O.call(t,a)&&m(e,a,t[a]);return e};import{v as S}from"./vue-select.c5557806.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";import{d as V,n as P,Q as w,w as g,r as C,o as R,f as b,J as $,R as Q}from"./main.9e765f7d.js";const q=V({name:"AcaciaRichSelect",components:{"v-select":S},emits:["update:modelValue"],model:{prop:"modelValue",event:"update:modelValue"},props:{apiUrl:{required:!0,type:String},queryParams:{required:!1,default:()=>({})},perPage:{required:!1,default:15},multiple:{type:Boolean,default:!1},modelValue:{default:null},label:{required:!0,type:String},reduce:{type:Function},placeholder:String},data:()=>({observer:null,paginatedObject:{data:[]},searchQuery:null}),mounted(){this.paginatedObject.per_page=parseInt(this.perPage)||15,this.selected=this.initValue,this.observer=new IntersectionObserver(this.infiniteScroll)},methods:{async onOpen(){this.hasNextPage&&(await this.$nextTick(),this.observer.observe(this.$refs.infiniteSelectLoad))},onClose(){this.observer.disconnect(),this.searchQuery=null},onSelect(e){this.$emit("update:modelValue",e)},async fetchResults(e,t,a=!1){const l=this;e&&(l.searchQuery=e);let r={};if(l.paginatedObject.current_page&&a){if(!l.paginatedObject.next_page_url)return!1;r.page=l.paginatedObject.current_page+1,r.per_page=l.paginatedObject.per_page}return l.searchQuery&&(r.search=l.searchQuery),r=i(i({},r),l.queryParams),new Promise((c,o)=>{const s=this;axios.get(s.apiUrl,{params:r}).then(n=>{var p,d,u,h;const _=(p=s.paginatedObject)==null?void 0:p.data;s.paginatedObject=(d=n==null?void 0:n.data)==null?void 0:d.payload,a&&(s.paginatedObject.data=[..._,...(h=(u=n.data)==null?void 0:u.payload)==null?void 0:h.data]),c(n)}).catch(n=>{o(n)}).finally(n=>{})})},async infiniteScroll([{isIntersecting:e,target:t}]){if(e){const a=t.offsetParent,l=t.offsetParent.scrollTop;await this.fetchResults(null,!0,!0),a.scrollTop=l}}},computed:{hasNextPage(){var t,a;let e=this;return e.paginatedObject.current_page&&e.paginatedObject.next_page_url||!((a=(t=e.paginatedObject)==null?void 0:t.data)!=null&&a.length)&&!e.paginatedObject.current_page}},watch:{}}),k={ref:"infiniteSelectLoad",class:"loader"};function B(e,t,a,l,r,c){const o=C("v-select");return R(),P(o,{class:"p-input-filled p-inputtext p-inputtext-sm",modelValue:e.modelValue,"onUpdate:modelValue":e.onSelect,multiple:e.multiple,options:e.paginatedObject.data,filterable:!1,"clear-on-select":!0,reduce:e.reduce,placeholder:e.placeholder,label:e.label,onOpen:e.onOpen,onClose:e.onClose,onSearch:e.fetchResults,ref:"richSelect"},w({search:g(({attributes:s,events:n})=>[b("input",$({style:{"border-right":"none !important"},class:"vs__search"},s,Q(n)),null,16)]),_:2},[e.hasNextPage?{name:"list-footer",fn:g(()=>[b("li",k," Loading more options... ",512)])}:void 0]),1032,["modelValue","onUpdate:modelValue","multiple","options","reduce","placeholder","label","onOpen","onClose","onSearch"])}var A=j(q,[["render",B]]);export{A as default};
