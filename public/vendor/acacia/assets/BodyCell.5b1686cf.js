import{a5 as r,aa as v,i as d,v as s,Q as h,an as E,x as f,z as b,s as c,F as g,M as m,k as w,y as p,r as k,O as R,o as n}from"./vendor.05df324e.js";import{O as y}from"./overlayeventbus.esm.d529c5a8.js";import D from"./RowRadioButton.cafc79f8.js";import P from"./RowCheckbox.8d11c892.js";import{R as _}from"./ripple.esm.574b991d.js";import{_ as S}from"./plugin-vue_export-helper.21dcd24c.js";const L={name:"BodyCell",emits:["cell-edit-init","cell-edit-complete","cell-edit-cancel","row-edit-init","row-edit-save","row-edit-cancel","row-toggle","radio-change","checkbox-change","editing-meta-change"],props:{rowData:{type:Object,default:null},column:{type:Object,default:null},frozenRow:{type:Boolean,default:!1},rowIndex:{type:Number,default:null},index:{type:Number,default:null},rowTogglerIcon:{type:Array,default:null},selected:{type:Boolean,default:!1},editing:{type:Boolean,default:!1},editingMeta:{type:Object,default:null},editMode:{type:String,default:null},responsiveLayout:{type:String,default:"stack"},virtualScrollerContentProps:{type:Object,default:null}},documentEditListener:null,selfClick:!1,overlayEventListener:null,data(){return{d_editing:this.editing,styleObject:{}}},watch:{editing(e){this.d_editing=e},"$data.d_editing":function(e){this.$emit("editing-meta-change",{data:this.rowData,field:this.field||`field_${this.index}`,index:this.rowIndex,editing:e})}},mounted(){this.columnProp("frozen")&&this.updateStickyPosition()},updated(){if(this.columnProp("frozen")&&this.updateStickyPosition(),this.d_editing&&(this.editMode==="cell"||this.editMode==="row"&&this.columnProp("rowEditor"))){const e=r.getFirstFocusableElement(this.$el);e&&e.focus()}},beforeUnmount(){this.overlayEventListener&&(y.off("overlay-click",this.overlayEventListener),this.overlayEventListener=null)},methods:{columnProp(e){return v.getVNodeProp(this.column,e)},resolveFieldData(){return v.resolveFieldData(this.rowData,this.field)},toggleRow(e){this.$emit("row-toggle",{originalEvent:e,data:this.rowData})},toggleRowWithRadio(e){this.$emit("radio-change",e)},toggleRowWithCheckbox(e){this.$emit("checkbox-change",e)},isEditable(){return this.column.children&&this.column.children.editor!=null},bindDocumentEditListener(){this.documentEditListener||(this.documentEditListener=e=>{this.selfClick||this.completeEdit(e,"outside"),this.selfClick=!1},document.addEventListener("click",this.documentEditListener))},unbindDocumentEditListener(){this.documentEditListener&&(document.removeEventListener("click",this.documentEditListener),this.documentEditListener=null,this.selfClick=!1)},switchCellToViewMode(){this.d_editing=!1,this.unbindDocumentEditListener(),y.off("overlay-click",this.overlayEventListener),this.overlayEventListener=null},onClick(e){this.editMode==="cell"&&this.isEditable()&&(this.selfClick=!0,this.d_editing||(this.d_editing=!0,this.bindDocumentEditListener(),this.$emit("cell-edit-init",{originalEvent:e,data:this.rowData,field:this.field,index:this.rowIndex}),this.overlayEventListener=i=>{this.$el&&this.$el.contains(i.target)&&(this.selfClick=!0)},y.on("overlay-click",this.overlayEventListener)))},completeEdit(e,i){const t={originalEvent:e,data:this.rowData,newData:this.editingRowData,value:this.rowData[this.field],newValue:this.editingRowData[this.field],field:this.field,index:this.rowIndex,type:i,defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0}};this.$emit("cell-edit-complete",t),t.defaultPrevented||this.switchCellToViewMode()},onKeyDown(e){if(this.editMode==="cell")switch(e.which){case 13:this.completeEdit(e,"enter");break;case 27:this.switchCellToViewMode(),this.$emit("cell-edit-cancel",{originalEvent:e,data:this.rowData,field:this.field,index:this.rowIndex});break;case 9:this.completeEdit(e,"tab"),e.shiftKey?this.moveToPreviousCell(e):this.moveToNextCell(e);break}},moveToPreviousCell(e){let i=this.findCell(e.target),t=this.findPreviousEditableColumn(i);t&&(r.invokeElementMethod(t,"click"),e.preventDefault())},moveToNextCell(e){let i=this.findCell(e.target),t=this.findNextEditableColumn(i);t&&(r.invokeElementMethod(t,"click"),e.preventDefault())},findCell(e){if(e){let i=e;for(;i&&!r.hasClass(i,"p-cell-editing");)i=i.parentElement;return i}else return null},findPreviousEditableColumn(e){let i=e.previousElementSibling;if(!i){let t=e.parentElement.previousElementSibling;t&&(i=t.lastElementChild)}return i?r.hasClass(i,"p-editable-column")?i:this.findPreviousEditableColumn(i):null},findNextEditableColumn(e){let i=e.nextElementSibling;if(!i){let t=e.parentElement.nextElementSibling;t&&(i=t.firstElementChild)}return i?r.hasClass(i,"p-editable-column")?i:this.findNextEditableColumn(i):null},isEditingCellValid(){return r.find(this.$el,".p-invalid").length===0},onRowEditInit(e){this.$emit("row-edit-init",{originalEvent:e,data:this.rowData,newData:this.editingRowData,field:this.field,index:this.rowIndex})},onRowEditSave(e){this.$emit("row-edit-save",{originalEvent:e,data:this.rowData,newData:this.editingRowData,field:this.field,index:this.rowIndex})},onRowEditCancel(e){this.$emit("row-edit-cancel",{originalEvent:e,data:this.rowData,newData:this.editingRowData,field:this.field,index:this.rowIndex})},updateStickyPosition(){if(this.columnProp("frozen"))if(this.columnProp("alignFrozen")==="right"){let i=0,t=this.$el.nextElementSibling;t&&(i=r.getOuterWidth(t)+parseFloat(t.style.right||0)),this.styleObject.right=i+"px"}else{let i=0,t=this.$el.previousElementSibling;t&&(i=r.getOuterWidth(t)+parseFloat(t.style.left||0)),this.styleObject.left=i+"px"}},getVirtualScrollerProp(e){return this.virtualScrollerContentProps?this.virtualScrollerContentProps[e]:null}},computed:{editingRowData(){return this.editingMeta[this.rowIndex]?this.editingMeta[this.rowIndex].data:this.rowData},field(){return this.columnProp("field")},containerClass(){return[this.columnProp("bodyClass"),this.columnProp("class"),{"p-selection-column":this.columnProp("selectionMode")!=null,"p-editable-column":this.isEditable(),"p-cell-editing":this.d_editing,"p-frozen-column":this.columnProp("frozen")}]},containerStyle(){let e=this.columnProp("bodyStyle"),i=this.columnProp("style");return this.columnProp("frozen")?[i,e,this.styleObject]:[i,e]},loading(){return this.getVirtualScrollerProp("loading")},loadingOptions(){const e=this.getVirtualScrollerProp("getLoaderOptions");return e&&e(this.rowIndex,{cellIndex:this.index,cellFirst:this.index===0,cellLast:this.index===this.getVirtualScrollerProp("columns").length-1,cellEven:this.index%2==0,cellOdd:this.index%2!=0,column:this.column,field:this.field})}},components:{DTRadioButton:D,DTCheckbox:P},directives:{ripple:_}},z={key:0,class:"p-column-title"},I=w("span",{class:"p-row-editor-init-icon pi pi-fw pi-pencil"},null,-1),O=[I],M=w("span",{class:"p-row-editor-save-icon pi pi-fw pi-check"},null,-1),T=[M],j=w("span",{class:"p-row-editor-cancel-icon pi pi-fw pi-times"},null,-1),B=[j];function V(e,i,t,F,a,l){const C=k("DTRadioButton"),x=k("DTCheckbox"),u=R("ripple");return l.loading?(n(),d("td",{key:0,style:E(l.containerStyle),class:f(l.containerClass)},[(n(),s(h(t.column.children.loading),{data:t.rowData,column:t.column,field:l.field,index:t.rowIndex,frozenRow:t.frozenRow,loadingOptions:l.loadingOptions},null,8,["data","column","field","index","frozenRow","loadingOptions"]))],6)):(n(),d("td",{key:1,style:E(l.containerStyle),class:f(l.containerClass),onClick:i[4]||(i[4]=(...o)=>l.onClick&&l.onClick(...o)),onKeydown:i[5]||(i[5]=(...o)=>l.onKeyDown&&l.onKeyDown(...o)),role:"cell"},[t.responsiveLayout==="stack"?(n(),d("span",z,b(l.columnProp("header")),1)):c("",!0),t.column.children&&t.column.children.body&&!a.d_editing?(n(),s(h(t.column.children.body),{key:1,data:t.rowData,column:t.column,field:l.field,index:t.rowIndex,frozenRow:t.frozenRow},null,8,["data","column","field","index","frozenRow"])):t.column.children&&t.column.children.editor&&a.d_editing?(n(),s(h(t.column.children.editor),{key:2,data:l.editingRowData,column:t.column,field:l.field,index:t.rowIndex,frozenRow:t.frozenRow},null,8,["data","column","field","index","frozenRow"])):t.column.children&&t.column.children.body&&!t.column.children.editor&&a.d_editing?(n(),s(h(t.column.children.body),{key:3,data:l.editingRowData,column:t.column,field:l.field,index:t.rowIndex,frozenRow:t.frozenRow},null,8,["data","column","field","index","frozenRow"])):l.columnProp("selectionMode")?(n(),d(g,{key:4},[l.columnProp("selectionMode")==="single"?(n(),s(C,{key:0,value:t.rowData,checked:t.selected,onChange:l.toggleRowWithRadio},null,8,["value","checked","onChange"])):l.columnProp("selectionMode")==="multiple"?(n(),s(x,{key:1,value:t.rowData,checked:t.selected,onChange:l.toggleRowWithCheckbox},null,8,["value","checked","onChange"])):c("",!0)],64)):l.columnProp("rowReorder")?(n(),d("i",{key:5,class:f(["p-datatable-reorderablerow-handle",l.columnProp("rowReorderIcon")||"pi pi-bars"])},null,2)):l.columnProp("expander")?m((n(),d("button",{key:6,class:"p-row-toggler p-link",onClick:i[0]||(i[0]=(...o)=>l.toggleRow&&l.toggleRow(...o)),type:"button"},[w("span",{class:f(t.rowTogglerIcon)},null,2)])),[[u]]):t.editMode==="row"&&l.columnProp("rowEditor")?(n(),d(g,{key:7},[a.d_editing?c("",!0):m((n(),d("button",{key:0,class:"p-row-editor-init p-link",onClick:i[1]||(i[1]=(...o)=>l.onRowEditInit&&l.onRowEditInit(...o)),type:"button"},O)),[[u]]),a.d_editing?m((n(),d("button",{key:1,class:"p-row-editor-save p-link",onClick:i[2]||(i[2]=(...o)=>l.onRowEditSave&&l.onRowEditSave(...o)),type:"button"},T)),[[u]]):c("",!0),a.d_editing?m((n(),d("button",{key:2,class:"p-row-editor-cancel p-link",onClick:i[3]||(i[3]=(...o)=>l.onRowEditCancel&&l.onRowEditCancel(...o)),type:"button"},B)),[[u]]):c("",!0)],64)):(n(),d(g,{key:8},[p(b(l.resolveFieldData()),1)],64))],38))}var Q=S(L,[["render",V]]);export{Q as default};
