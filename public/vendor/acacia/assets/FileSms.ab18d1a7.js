import T from"./Authenticated.77f2a621.js";import{s as _}from"./button.esm.cbb15c31.js";import U from"./BackLink.b4c17133.js";import{s as j,a as z}from"./divider.esm.2d8e81af.js";import{s as A}from"./progressbar.esm.5be64e16.js";import{s as N}from"./message.esm.2b7d3da1.js";import{a5 as S,r as f,O as R,o as n,v as d,j as a,M as D,_ as E,z as h,s as y,F as w,t as x,w as c,y as F,q as V,e as P,p as k,u as O,g as K,A as W,Y as q,d as H,k as m,i as M,af as X,B as Y}from"./vendor.05df324e.js";import{R as G}from"./ripple.esm.574b991d.js";import{s as Z}from"./tag.esm.ade7af22.js";import{s as J}from"./textarea.esm.b60c054e.js";import{_ as Q}from"./plugin-vue_export-helper.21dcd24c.js";import"./XIcon.cfe89bae.js";import"./confirmdialog.esm.5be0612a.js";import"./dialog.esm.7f94084b.js";var I={name:"FileUpload",emits:["select","uploader","before-upload","progress","upload","error","before-send","clear","remove"],props:{name:{type:String,default:null},url:{type:String,default:null},mode:{type:String,default:"advanced"},multiple:{type:Boolean,default:!1},accept:{type:String,default:null},disabled:{type:Boolean,default:!1},auto:{type:Boolean,default:!1},maxFileSize:{type:Number,default:null},invalidFileSizeMessage:{type:String,default:"{0}: Invalid file size, file size should be smaller than {1}."},invalidFileTypeMessage:{type:String,default:"{0}: Invalid file type, allowed file types: {1}."},fileLimit:{type:Number,default:null},invalidFileLimitMessage:{type:String,default:"Maximum number of files exceeded, limit is {0} at most."},withCredentials:{type:Boolean,default:!1},previewWidth:{type:Number,default:50},chooseLabel:{type:String,default:null},uploadLabel:{type:String,default:null},cancelLabel:{type:String,default:null},customUpload:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},style:null,class:null},duplicateIEEvent:!1,data(){return{uploadedFileCount:0,files:[],messages:[],focused:!1,progress:null}},methods:{onFileSelect(e){if(e.type!=="drop"&&this.isIE11()&&this.duplicateIEEvent){this.duplicateIEEvent=!1;return}this.messages=[],this.files=this.files||[];let t=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let i of t)this.isFileSelected(i)||this.validate(i)&&(this.isImage(i)&&(i.objectURL=window.URL.createObjectURL(i)),this.files.push(i));this.$emit("select",{originalEvent:e,files:this.files}),this.fileLimit&&this.checkFileLimit(),this.auto&&this.hasFiles&&!this.isFileLimitExceeded()&&this.upload(),e.type!=="drop"&&this.isIE11()?this.clearIEInput():this.clearInputElement()},choose(){this.$refs.fileInput.click()},upload(){if(this.customUpload)this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("uploader",{files:this.files});else{let e=new XMLHttpRequest,t=new FormData;this.$emit("before-upload",{xhr:e,formData:t});for(let i of this.files)t.append(this.name,i,i.name);e.upload.addEventListener("progress",i=>{i.lengthComputable&&(this.progress=Math.round(i.loaded*100/i.total)),this.$emit("progress",{originalEvent:i,progress:this.progress})}),e.onreadystatechange=()=>{e.readyState===4&&(this.progress=0,e.status>=200&&e.status<300?(this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("upload",{xhr:e,files:this.files})):this.$emit("error",{xhr:e,files:this.files}),this.clear())},e.open("POST",this.url,!0),this.$emit("before-send",{xhr:e,formData:t}),e.withCredentials=this.withCredentials,e.send(t)}},clear(){this.files=[],this.messages=null,this.$emit("clear"),this.isAdvanced&&this.clearInputElement()},onFocus(){this.focused=!0},onBlur(){this.focused=!1},isFileSelected(e){if(this.files&&this.files.length){for(let t of this.files)if(t.name+t.type+t.size===e.name+e.type+e.size)return!0}return!1},isIE11(){return!!window.MSInputMethodContext&&!!document.documentMode},validate(e){return this.accept&&!this.isFileTypeValid(e)?(this.messages.push(this.invalidFileTypeMessage.replace("{0}",e.name).replace("{1}",this.accept)),!1):this.maxFileSize&&e.size>this.maxFileSize?(this.messages.push(this.invalidFileSizeMessage.replace("{0}",e.name).replace("{1}",this.formatSize(this.maxFileSize))),!1):!0},isFileTypeValid(e){let t=this.accept.split(",").map(i=>i.trim());for(let i of t)if(this.isWildcard(i)?this.getTypeClass(e.type)===this.getTypeClass(i):e.type==i||this.getFileExtension(e).toLowerCase()===i.toLowerCase())return!0;return!1},getTypeClass(e){return e.substring(0,e.indexOf("/"))},isWildcard(e){return e.indexOf("*")!==-1},getFileExtension(e){return"."+e.name.split(".").pop()},isImage(e){return/^image\//.test(e.type)},onDragEnter(e){this.disabled||(e.stopPropagation(),e.preventDefault())},onDragOver(e){this.disabled||(S.addClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},onDragLeave(){this.disabled||S.removeClass(this.$refs.content,"p-fileupload-highlight")},onDrop(e){if(!this.disabled){S.removeClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();const t=e.dataTransfer?e.dataTransfer.files:e.target.files;(this.multiple||t&&t.length===1)&&this.onFileSelect(e)}},onBasicUploaderClick(){this.hasFiles?this.upload():this.$refs.fileInput.click()},remove(e){this.clearInputElement();let t=this.files.splice(e,1)[0];this.files=[...this.files],this.$emit("remove",{file:t,files:this.files})},clearInputElement(){this.$refs.fileInput.value=""},clearIEInput(){this.$refs.fileInput&&(this.duplicateIEEvent=!0,this.$refs.fileInput.value="")},formatSize(e){if(e===0)return"0 B";let t=1e3,i=3,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(i))+" "+r[o]},isFileLimitExceeded(){return this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount&&this.focused&&(this.focused=!1),this.fileLimit&&this.fileLimit<this.files.length+this.uploadedFileCount},checkFileLimit(){this.isFileLimitExceeded()&&this.messages.push(this.invalidFileLimitMessage.replace("{0}",this.fileLimit.toString()))},onMessageClose(){this.messages=null}},computed:{isAdvanced(){return this.mode==="advanced"},isBasic(){return this.mode==="basic"},advancedChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-fileupload-choose-selected":this.hasFiles,"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonIconClass(){return["p-button-icon p-button-icon-left pi",{"pi-plus":!this.hasFiles||this.auto,"pi-upload":this.hasFiles&&!this.auto}]},basicChooseButtonLabel(){return this.auto?this.chooseButtonLabel:this.hasFiles?this.files.map(e=>e.name).join(", "):this.chooseButtonLabel},hasFiles(){return this.files&&this.files.length>0},chooseDisabled(){return this.disabled||this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount},uploadDisabled(){return this.disabled||!this.hasFiles||this.fileLimit&&this.fileLimit<this.files.length},cancelDisabled(){return this.disabled||!this.hasFiles},chooseButtonLabel(){return this.chooseLabel||this.$primevue.config.locale.choose},uploadButtonLabel(){return this.uploadLabel||this.$primevue.config.locale.upload},cancelButtonLabel(){return this.cancelLabel||this.$primevue.config.locale.cancel}},components:{FileUploadButton:_,FileUploadProgressBar:A,FileUploadMessage:N},directives:{ripple:G}};const $={key:0,class:"p-fileupload p-fileupload-advanced p-component"},ee={class:"p-fileupload-buttonbar"},te=a("span",{class:"p-button-icon p-button-icon-left pi pi-fw pi-plus"},null,-1),se={class:"p-button-label"},le={key:1,class:"p-fileupload-files"},ie={class:"p-fileupload-filename"},ae={key:2,class:"p-fileupload-empty"},oe={key:1,class:"p-fileupload p-fileupload-basic p-component"},ne={class:"p-button-label"};function re(e,t,i,r,o,s){const b=f("FileUploadButton"),C=f("FileUploadProgressBar"),v=f("FileUploadMessage"),B=R("ripple");return s.isAdvanced?(n(),d("div",$,[a("div",ee,[D(a("span",{class:s.advancedChooseButtonClass,style:i.style,onClick:t[2]||(t[2]=(...l)=>s.choose&&s.choose(...l)),onKeydown:t[3]||(t[3]=E((...l)=>s.choose&&s.choose(...l),["enter"])),onFocus:t[4]||(t[4]=(...l)=>s.onFocus&&s.onFocus(...l)),onBlur:t[5]||(t[5]=(...l)=>s.onBlur&&s.onBlur(...l)),tabindex:"0"},[a("input",{ref:"fileInput",type:"file",onChange:t[1]||(t[1]=(...l)=>s.onFileSelect&&s.onFileSelect(...l)),multiple:i.multiple,accept:i.accept,disabled:s.chooseDisabled},null,40,["multiple","accept","disabled"]),te,a("span",se,h(s.chooseButtonLabel),1)],38),[[B]]),i.showUploadButton?(n(),d(b,{key:0,label:s.uploadButtonLabel,icon:"pi pi-upload",onClick:s.upload,disabled:s.uploadDisabled},null,8,["label","onClick","disabled"])):y("",!0),i.showCancelButton?(n(),d(b,{key:1,label:s.cancelButtonLabel,icon:"pi pi-times",onClick:s.clear,disabled:s.cancelDisabled},null,8,["label","onClick","disabled"])):y("",!0)]),a("div",{ref:"content",class:"p-fileupload-content",onDragenter:t[6]||(t[6]=(...l)=>s.onDragEnter&&s.onDragEnter(...l)),onDragover:t[7]||(t[7]=(...l)=>s.onDragOver&&s.onDragOver(...l)),onDragleave:t[8]||(t[8]=(...l)=>s.onDragLeave&&s.onDragLeave(...l)),onDrop:t[9]||(t[9]=(...l)=>s.onDrop&&s.onDrop(...l))},[s.hasFiles?(n(),d(C,{key:0,value:o.progress},null,8,["value"])):y("",!0),(n(!0),d(w,null,x(o.messages,l=>(n(),d(v,{severity:"error",key:l,onClose:s.onMessageClose},{default:c(()=>[F(h(l),1)]),_:2},1032,["onClose"]))),128)),s.hasFiles?(n(),d("div",le,[(n(!0),d(w,null,x(o.files,(l,u)=>(n(),d("div",{class:"p-fileupload-row",key:l.name+l.type+l.size},[a("div",null,[s.isImage(l)?(n(),d("img",{key:0,role:"presentation",alt:l.name,src:l.objectURL,width:i.previewWidth},null,8,["alt","src","width"])):y("",!0)]),a("div",ie,h(l.name),1),a("div",null,h(s.formatSize(l.size)),1),a("div",null,[a(b,{type:"button",icon:"pi pi-times",onClick:p=>s.remove(u)},null,8,["onClick"])])]))),128))])):y("",!0),e.$slots.empty&&!s.hasFiles?(n(),d("div",ae,[V(e.$slots,"empty")])):y("",!0)],544)])):s.isBasic?(n(),d("div",oe,[(n(!0),d(w,null,x(o.messages,l=>(n(),d(v,{severity:"error",key:l,onClose:s.onMessageClose},{default:c(()=>[F(h(l),1)]),_:2},1032,["onClose"]))),128)),D(a("span",{class:s.basicChooseButtonClass,style:i.style,onMouseup:t[13]||(t[13]=(...l)=>s.onBasicUploaderClick&&s.onBasicUploaderClick(...l)),onKeydown:t[14]||(t[14]=E((...l)=>s.choose&&s.choose(...l),["enter"])),onFocus:t[15]||(t[15]=(...l)=>s.onFocus&&s.onFocus(...l)),onBlur:t[16]||(t[16]=(...l)=>s.onBlur&&s.onBlur(...l)),tabindex:"0"},[a("span",{class:s.basicChooseButtonIconClass},null,2),a("span",ne,h(s.basicChooseButtonLabel),1),s.hasFiles?y("",!0):(n(),d("input",{key:0,ref:"fileInput",type:"file",accept:i.accept,disabled:i.disabled,multiple:i.multiple,onChange:t[10]||(t[10]=(...l)=>s.onFileSelect&&s.onFileSelect(...l)),onFocus:t[11]||(t[11]=(...l)=>s.onFocus&&s.onFocus(...l)),onBlur:t[12]||(t[12]=(...l)=>s.onBlur&&s.onBlur(...l))},null,40,["accept","disabled","multiple"]))],38),[[B]])])):y("",!0)}function de(e,t){t===void 0&&(t={});var i=t.insertAt;if(!(!e||typeof document=="undefined")){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",i==="top"&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}var ue=`
.p-fileupload-content {
    position: relative;
}
.p-fileupload-row {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
}
.p-fileupload-row > div {
    -webkit-box-flex: 1;
        -ms-flex: 1 1 auto;
            flex: 1 1 auto;
    width: 25%;
}
.p-fileupload-row > div:last-child {
    text-align: right;
}
.p-fileupload-content .p-progressbar {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
}
.p-button.p-fileupload-choose {
    position: relative;
    overflow: hidden;
}
.p-button.p-fileupload-choose input[type=file] {
    display: none;
}
.p-fileupload-choose.p-fileupload-choose-selected input[type=file] {
    display: none;
}
.p-fileupload-filename {
    word-break: break-all;
}
.p-fluid .p-fileupload .p-button {
    width: auto;
}
`;de(ue);I.render=re;const pe=P({name:"FileSms",components:{BackLink:U,Authenticated:T,Button:_,FileUpload:I,Card:j,Divider:z,Tag:Z,Textarea:J},setup(e,{}){const t=k(),i=k([{variable:"first_name",title:"First Name"},{variable:"middle_name",title:"Middle Name"},{variable:"surname_name",title:"Surname"},{variable:"bill_amount",title:"Bill Amount"},{variable:"bill_due_date",title:"Bill Due Date"}]),r=O({message:"",file:null}),o=K(),s=k(!1),b=k(160),C=W(()=>{var u,p;return b.value-((p=(u=r.message)==null?void 0:u.length)!=null?p:0)}),v=u=>{B(`{{${u}}}`,t.value)},B=async(u,p=document.activeElement)=>{const[L,g]=[p.selectionStart,p.selectionEnd];p.setRangeText(u,L,g,"select"),await q(),p.setSelectionRange(g+u.length,g+u.length),p.focus()};return{messageEl:t,templateVars:i,form:r,maxMessageLength:b,remainingChars:C,loading:s,insertToTemplate:v,submitFile:async u=>{try{if(s.value=!0,r.file=u.files[0],!r.message)throw o.add({life:3e3,summary:"Missing Message",detail:"Please draft your message first before uploading the recipients file.",severity:"error"}),new Error("Missing Message");await r.post(H("app.sms.file-upload")),s.value=!1}catch{s.value=!1}}}}}),ce={class:"flex items-center flex-wrap gap-x-2"},fe=F(" File Upload SMS "),he={href:"download"},me=F("Compose Message "),ge=m("h5",{class:"font-bold text-lg"},[F("Available Template Variables "),m("small",null,[m("strong",null,"(click any to insert to template)")])],-1),be={class:"flex flex-wrap gap-2 items-center"},ve=["onClick"],ye=F("Upload Excel File"),Fe=m("p",null,"Drag and drop your excel here to upload.",-1);function Be(e,t,i,r,o,s){const b=f("BackLink"),C=f("Button"),v=f("Card"),B=f("Tag"),l=f("Divider"),u=f("FileUpload"),p=f("Authenticated");return n(),d(p,null,{header:c(()=>[m("div",ce,[a(b,{href:e.route("app.sms.index")},null,8,["href"]),fe])]),default:c(()=>[a(v,{class:"my-2"},{content:c(()=>[m("a",he,[a(C,{icon:"pi pi-download",label:"Download Template File"})])]),_:1}),a(v,{class:"my-2"},{title:c(()=>[me]),content:c(()=>{var L;return[ge,m("div",be,[(n(!0),M(w,null,x(e.templateVars,g=>(n(),M("button",{key:g.variable,onClick:Ce=>e.insertToTemplate(g.variable)},[a(B,null,{default:c(()=>[F(h(g.title),1)]),_:2},1024)],8,ve))),128))]),m("form",{onSubmit:t[1]||(t[1]=Y(()=>{},["prevent"])),class:"my-4"},[D(m("textarea",{class:"p-inputtext w-full",placeholder:"Type your message here",ref:"messageEl","onUpdate:modelValue":t[0]||(t[0]=g=>e.form.message=g)},null,512),[[X,e.form.message]]),m("span",null,"Chars: "+h(((L=e.form.message)==null?void 0:L.length)||0)+"/"+h(e.maxMessageLength)+" Remaining: "+h(e.remainingChars),1)],32)]}),_:1}),a(l),a(v,null,{title:c(()=>[ye]),content:c(()=>[a(u,{disabled:e.loading,customUpload:!0,onUploader:e.submitFile,name:"sms_file",url:"./upload",accept:"text/csv,application/csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel"},{empty:c(()=>[Fe]),_:1},8,["disabled","onUploader"])]),_:1})]),_:1})}var Ae=Q(pe,[["render",Be]]);export{Ae as default};
