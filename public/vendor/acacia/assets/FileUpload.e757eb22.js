import{s as E}from"./button.esm.cbb15c31.js";import{s as I}from"./progressbar.esm.5be64e16.js";import{s as x}from"./message.esm.2b7d3da1.js";import{a5 as c,i as o,k as r,M as B,x as m,an as C,_ as L,z as d,v as h,s as n,F as g,t as b,q as M,r as F,O as U,o as a,w as D,y as S,j as z}from"./vendor.05df324e.js";import{R as _}from"./ripple.esm.574b991d.js";import{_ as T}from"./plugin-vue_export-helper.21dcd24c.js";const j={name:"FileUpload",emits:["select","uploader","before-upload","progress","upload","error","before-send","clear","remove"],props:{name:{type:String,default:null},url:{type:String,default:null},mode:{type:String,default:"advanced"},multiple:{type:Boolean,default:!1},accept:{type:String,default:null},disabled:{type:Boolean,default:!1},auto:{type:Boolean,default:!1},maxFileSize:{type:Number,default:null},invalidFileSizeMessage:{type:String,default:"{0}: Invalid file size, file size should be smaller than {1}."},invalidFileTypeMessage:{type:String,default:"{0}: Invalid file type, allowed file types: {1}."},fileLimit:{type:Number,default:null},invalidFileLimitMessage:{type:String,default:"Maximum number of files exceeded, limit is {0} at most."},withCredentials:{type:Boolean,default:!1},previewWidth:{type:Number,default:50},chooseLabel:{type:String,default:null},uploadLabel:{type:String,default:null},cancelLabel:{type:String,default:null},customUpload:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},style:null,class:null},duplicateIEEvent:!1,data(){return{uploadedFileCount:0,files:[],messages:[],focused:!1,progress:null}},methods:{onFileSelect(e){if(e.type!=="drop"&&this.isIE11()&&this.duplicateIEEvent){this.duplicateIEEvent=!1;return}this.messages=[],this.files=this.files||[];let s=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let i of s)this.isFileSelected(i)||this.validate(i)&&(this.isImage(i)&&(i.objectURL=window.URL.createObjectURL(i)),this.files.push(i));this.$emit("select",{originalEvent:e,files:this.files}),this.fileLimit&&this.checkFileLimit(),this.auto&&this.hasFiles&&!this.isFileLimitExceeded()&&this.upload(),e.type!=="drop"&&this.isIE11()?this.clearIEInput():this.clearInputElement()},choose(){this.$refs.fileInput.click()},upload(){if(this.customUpload)this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("uploader",{files:this.files});else{let e=new XMLHttpRequest,s=new FormData;this.$emit("before-upload",{xhr:e,formData:s});for(let i of this.files)s.append(this.name,i,i.name);e.upload.addEventListener("progress",i=>{i.lengthComputable&&(this.progress=Math.round(i.loaded*100/i.total)),this.$emit("progress",{originalEvent:i,progress:this.progress})}),e.onreadystatechange=()=>{e.readyState===4&&(this.progress=0,e.status>=200&&e.status<300?(this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("upload",{xhr:e,files:this.files})):this.$emit("error",{xhr:e,files:this.files}),this.clear())},e.open("POST",this.url,!0),this.$emit("before-send",{xhr:e,formData:s}),e.withCredentials=this.withCredentials,e.send(s)}},clear(){this.files=[],this.messages=null,this.$emit("clear"),this.isAdvanced&&this.clearInputElement()},onFocus(){this.focused=!0},onBlur(){this.focused=!1},isFileSelected(e){if(this.files&&this.files.length){for(let s of this.files)if(s.name+s.type+s.size===e.name+e.type+e.size)return!0}return!1},isIE11(){return!!window.MSInputMethodContext&&!!document.documentMode},validate(e){return this.accept&&!this.isFileTypeValid(e)?(this.messages.push(this.invalidFileTypeMessage.replace("{0}",e.name).replace("{1}",this.accept)),!1):this.maxFileSize&&e.size>this.maxFileSize?(this.messages.push(this.invalidFileSizeMessage.replace("{0}",e.name).replace("{1}",this.formatSize(this.maxFileSize))),!1):!0},isFileTypeValid(e){let s=this.accept.split(",").map(i=>i.trim());for(let i of s)if(this.isWildcard(i)?this.getTypeClass(e.type)===this.getTypeClass(i):e.type==i||this.getFileExtension(e).toLowerCase()===i.toLowerCase())return!0;return!1},getTypeClass(e){return e.substring(0,e.indexOf("/"))},isWildcard(e){return e.indexOf("*")!==-1},getFileExtension(e){return"."+e.name.split(".").pop()},isImage(e){return/^image\//.test(e.type)},onDragEnter(e){this.disabled||(e.stopPropagation(),e.preventDefault())},onDragOver(e){this.disabled||(c.addClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},onDragLeave(){this.disabled||c.removeClass(this.$refs.content,"p-fileupload-highlight")},onDrop(e){if(!this.disabled){c.removeClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();const s=e.dataTransfer?e.dataTransfer.files:e.target.files;(this.multiple||s&&s.length===1)&&this.onFileSelect(e)}},onBasicUploaderClick(){this.hasFiles?this.upload():this.$refs.fileInput.click()},remove(e){this.clearInputElement();let s=this.files.splice(e,1)[0];this.files=[...this.files],this.$emit("remove",{file:s,files:this.files})},clearInputElement(){this.$refs.fileInput.value=""},clearIEInput(){this.$refs.fileInput&&(this.duplicateIEEvent=!0,this.$refs.fileInput.value="")},formatSize(e){if(e===0)return"0 B";let s=1e3,i=3,p=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],u=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,u)).toFixed(i))+" "+p[u]},isFileLimitExceeded(){return this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount&&this.focused&&(this.focused=!1),this.fileLimit&&this.fileLimit<this.files.length+this.uploadedFileCount},checkFileLimit(){this.isFileLimitExceeded()&&this.messages.push(this.invalidFileLimitMessage.replace("{0}",this.fileLimit.toString()))},onMessageClose(){this.messages=null}},computed:{isAdvanced(){return this.mode==="advanced"},isBasic(){return this.mode==="basic"},advancedChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-fileupload-choose-selected":this.hasFiles,"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonIconClass(){return["p-button-icon p-button-icon-left pi",{"pi-plus":!this.hasFiles||this.auto,"pi-upload":this.hasFiles&&!this.auto}]},basicChooseButtonLabel(){return this.auto?this.chooseButtonLabel:this.hasFiles?this.files.map(e=>e.name).join(", "):this.chooseButtonLabel},hasFiles(){return this.files&&this.files.length>0},chooseDisabled(){return this.disabled||this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount},uploadDisabled(){return this.disabled||!this.hasFiles||this.fileLimit&&this.fileLimit<this.files.length},cancelDisabled(){return this.disabled||!this.hasFiles},chooseButtonLabel(){return this.chooseLabel||this.$primevue.config.locale.choose},uploadButtonLabel(){return this.uploadLabel||this.$primevue.config.locale.upload},cancelButtonLabel(){return this.cancelLabel||this.$primevue.config.locale.cancel}},components:{FileUploadButton:E,FileUploadProgressBar:I,FileUploadMessage:x},directives:{ripple:_}},O={key:0,class:"p-fileupload p-fileupload-advanced p-component"},P={class:"p-fileupload-buttonbar"},N=["multiple","accept","disabled"],R=r("span",{class:"p-button-icon p-button-icon-left pi pi-fw pi-plus"},null,-1),V={class:"p-button-label"},K={key:1,class:"p-fileupload-files"},W=["alt","src","width"],A={class:"p-fileupload-filename"},q={key:2,class:"p-fileupload-empty"},H={key:1,class:"p-fileupload p-fileupload-basic p-component"},G={class:"p-button-label"},X=["accept","disabled","multiple"];function Y(e,s,i,p,u,t){const f=F("FileUploadButton"),k=F("FileUploadProgressBar"),y=F("FileUploadMessage"),v=U("ripple");return t.isAdvanced?(a(),o("div",O,[r("div",P,[B((a(),o("span",{class:m(t.advancedChooseButtonClass),style:C(i.style),onClick:s[1]||(s[1]=(...l)=>t.choose&&t.choose(...l)),onKeydown:s[2]||(s[2]=L((...l)=>t.choose&&t.choose(...l),["enter"])),onFocus:s[3]||(s[3]=(...l)=>t.onFocus&&t.onFocus(...l)),onBlur:s[4]||(s[4]=(...l)=>t.onBlur&&t.onBlur(...l)),tabindex:"0"},[r("input",{ref:"fileInput",type:"file",onChange:s[0]||(s[0]=(...l)=>t.onFileSelect&&t.onFileSelect(...l)),multiple:i.multiple,accept:i.accept,disabled:t.chooseDisabled},null,40,N),R,r("span",V,d(t.chooseButtonLabel),1)],38)),[[v]]),i.showUploadButton?(a(),h(f,{key:0,label:t.uploadButtonLabel,icon:"pi pi-upload",onClick:t.upload,disabled:t.uploadDisabled},null,8,["label","onClick","disabled"])):n("",!0),i.showCancelButton?(a(),h(f,{key:1,label:t.cancelButtonLabel,icon:"pi pi-times",onClick:t.clear,disabled:t.cancelDisabled},null,8,["label","onClick","disabled"])):n("",!0)]),r("div",{ref:"content",class:"p-fileupload-content",onDragenter:s[5]||(s[5]=(...l)=>t.onDragEnter&&t.onDragEnter(...l)),onDragover:s[6]||(s[6]=(...l)=>t.onDragOver&&t.onDragOver(...l)),onDragleave:s[7]||(s[7]=(...l)=>t.onDragLeave&&t.onDragLeave(...l)),onDrop:s[8]||(s[8]=(...l)=>t.onDrop&&t.onDrop(...l))},[t.hasFiles?(a(),h(k,{key:0,value:u.progress},null,8,["value"])):n("",!0),(a(!0),o(g,null,b(u.messages,l=>(a(),h(y,{severity:"error",key:l,onClose:t.onMessageClose},{default:D(()=>[S(d(l),1)]),_:2},1032,["onClose"]))),128)),t.hasFiles?(a(),o("div",K,[(a(!0),o(g,null,b(u.files,(l,w)=>(a(),o("div",{class:"p-fileupload-row",key:l.name+l.type+l.size},[r("div",null,[t.isImage(l)?(a(),o("img",{key:0,role:"presentation",alt:l.name,src:l.objectURL,width:i.previewWidth},null,8,W)):n("",!0)]),r("div",A,d(l.name),1),r("div",null,d(t.formatSize(l.size)),1),r("div",null,[z(f,{type:"button",icon:"pi pi-times",onClick:Z=>t.remove(w)},null,8,["onClick"])])]))),128))])):n("",!0),e.$slots.empty&&!t.hasFiles?(a(),o("div",q,[M(e.$slots,"empty")])):n("",!0)],544)])):t.isBasic?(a(),o("div",H,[(a(!0),o(g,null,b(u.messages,l=>(a(),h(y,{severity:"error",key:l,onClose:t.onMessageClose},{default:D(()=>[S(d(l),1)]),_:2},1032,["onClose"]))),128)),B((a(),o("span",{class:m(t.basicChooseButtonClass),style:C(i.style),onMouseup:s[12]||(s[12]=(...l)=>t.onBasicUploaderClick&&t.onBasicUploaderClick(...l)),onKeydown:s[13]||(s[13]=L((...l)=>t.choose&&t.choose(...l),["enter"])),onFocus:s[14]||(s[14]=(...l)=>t.onFocus&&t.onFocus(...l)),onBlur:s[15]||(s[15]=(...l)=>t.onBlur&&t.onBlur(...l)),tabindex:"0"},[r("span",{class:m(t.basicChooseButtonIconClass)},null,2),r("span",G,d(t.basicChooseButtonLabel),1),t.hasFiles?n("",!0):(a(),o("input",{key:0,ref:"fileInput",type:"file",accept:i.accept,disabled:i.disabled,multiple:i.multiple,onChange:s[9]||(s[9]=(...l)=>t.onFileSelect&&t.onFileSelect(...l)),onFocus:s[10]||(s[10]=(...l)=>t.onFocus&&t.onFocus(...l)),onBlur:s[11]||(s[11]=(...l)=>t.onBlur&&t.onBlur(...l))},null,40,X))],38)),[[v]])])):n("",!0)}var le=T(j,[["render",Y]]);export{le as default};
